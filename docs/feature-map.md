# 機能と実装箇所の対応表

このドキュメントは、ゲームの各機能がどのファイルのどの部分で実装されているかをまとめたものです。
機能追加や改修を行う際の参考にしてください。

---

## 1. ゲーム全体の流れの管理 (`GameManager.js`)

ゲームの進行、状態管理、各マネージャーの連携など、ゲームの心臓部となるロジックを担当します。

- **ゲームの開始・初期化**
  - `startGame()`: ゲームのエントリーポイント。タイトル画面を表示します。
  - `setupCallbacks()`: `UIManager` からのボタンクリック等のイベントを受け取るためのコールバックを設定します。
- **キャラクター選択**
  - `handleCharacterSelect(characterType)`: キャラクター選択画面で決定ボタンが押された後に呼ばれ、プレイヤーオブジェクトを生成し、フィールド画面へ遷移します。
- **フィールドでの操作**
  - `walk()`: 十字キーが押されたときに呼ばれ、歩数カウントとエンカウント判定を行います。
  - `handleEncounter()`: エンカウント判定に成功したときに呼ばれ、敵を生成し、戦闘を開始します。
- **戦闘処理の管理**
  - `handleEncounter()` 内で `BattleManager` を生成し、戦闘を開始させます。
  - `handleBattleEnd(result)`: `BattleManager` から戦闘結果を受け取り、勝利・敗北・逃走に応じた処理を呼び出します。
  - `handleBattleWin(result)`: 戦闘勝利時の経験値加算やレベルアップ処理を行います。
  - `handleBattleLose()`: 戦闘敗北時のゲームオーバー処理を行います。
- **セーブ＆ロード**
  - `handleSaveGame()`: 現在のゲーム状態を `SaveManager` を使して保存します。
  - `handleLoadGame()`: `SaveManager` からセーブデータを読み込み、ゲーム状態を復元します。
- **ゲーム状態のリセット**
  - `resetGame()`: ゲームオーバー後などに、ゲームの状態を初期値に戻します。

---

## 2. 戦闘シーンのロジック (`BattleManager.js`)

戦闘中の「たたかう」「にげる」といったコマンドの処理や、ダメージ計算などの戦闘ロジックを担当します。

- **戦闘コマンド**
  - `attack()`: 「たたかう」が選択されたときの処理。
  - `escape()`: 「にげる」が選択されたときの処理。
- **戦闘結果の判定と通知**
  - `handleWin()`: 勝利条件を満たしたときに呼ばれ、`GameManager` に結果を通知します。
  - `handleLose()`: 敗北条件を満たしたときに呼ばれ、`GameManager` に結果を通知します。
  - `handleEscapeSuccess()`: 逃走成功時に呼ばれます。
  - `handleEscapeFailure()`: 逃走失敗時に呼ばれます。

---

## 3. UI の表示とイベント管理 (`UIManager.js`)

画面の表示更新、ボタンや入力欄といった DOM 要素の管理、ユーザー操作のイベントリスナー設定を担当します。ロジックは持たず、`GameManager` からの指示を受けて画面を更新します。

- **イベントリスナー設定**
  - `setupEventListeners()`: 各ボタン（スタート、こうげき、にげる等）がクリックされたことを検知し、`GameManager` に通知するための設定を行います。
- **画面要素の表示・更新**
  - `setPlayerImage(imageUrl)`, `showEnemy(imageUrl)`: キャラクターの画像を設定・表示します。
  - `setFieldBackground(imageUrl)`: フィールドの背景画像を設定します。
  - `updateStatusDisplay(...)`: 歩数や討伐数などのステータス情報を画面に表示・更新します。
  - `showOverlay(message)`, `hideOverlay()`: "GAME OVER" などのメッセージを画面に表示・非表示します。

---

## 4. シーン（画面）の切り替え (`SceneManager.js`)

「タイトル画面」「キャラクター選択画面」「フィールド画面」といった、ゲームの各シーンの表示・非表示を管理します。

- **シーン表示**
  - `show(sceneName)`: 指定されたシーンを表示し、他のシーンを非表示にします。

---

## 5. セーブ・ロード処理 (`SaveManager.js`)

`localStorage` を利用したゲームデータの保存と読み込みを専門に担当します。

- **データ保存**
  - `save(data)`: `GameManager` から受け取ったゲームデータを `localStorage` に書き込みます。
- **データ読み込み**
  - `load()`: `localStorage` からゲームデータを読み込んで返します。
- **セーブデータの有無**
  - `hasSaveData()`: セーブデータが存在するかどうかを返します。
